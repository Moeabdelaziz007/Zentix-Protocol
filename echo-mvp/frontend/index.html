<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo - Web3 Social Media</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .login-button {
            background-color: #0052ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .login-button:hover {
            background-color: #0042cc;
        }
        .post-form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .post-form textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            resize: vertical;
        }
        .post-form button {
            background-color: #0052ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        .post {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .post-author {
            font-weight: bold;
        }
        .post-timestamp {
            color: #666;
            font-size: 0.9em;
        }
        .post-content {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .post-actions {
            display: flex;
            gap: 15px;
        }
        .echo-button {
            background-color: #f0f0f0;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .echo-button:hover {
            background-color: #e0e0e0;
        }
        .echo-button.echoed {
            background-color: #0052ff;
            color: white;
        }
        .wallet-info {
            background-color: #e6f4ff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
        }
        .wallet-address {
            font-family: monospace;
            background-color: #f0f0f0;
            padding: 5px 10px;
            border-radius: 3px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Echo</h1>
            <p>Web3 Social Media - Get rewarded for your content</p>
            <button id="loginButton" class="login-button">Sign in with Coinbase</button>
        </header>

        <div id="app">
            <div id="walletInfo" class="wallet-info" style="display: none;">
                <h3>Your Wallet</h3>
                <p>Address: <span id="walletAddress" class="wallet-address"></span></p>
                <p>Balance: <span id="walletBalance">0</span> tokens</p>
            </div>

            <div id="postForm" class="post-form" style="display: none;">
                <h3>Create a new post</h3>
                <textarea id="postContent" placeholder="What's on your mind?"></textarea>
                <button id="submitPost">Post</button>
            </div>

            <div id="feed">
                <h2>Feed</h2>
                <!-- Posts will be dynamically added here -->
            </div>
        </div>
    </div>

    <script>
        // Mock data for demonstration
        let currentUser = null;
        let posts = [
            {
                id: 1,
                author: "0x1234...5678",
                content: "Just deployed my first smart contract on Base! This is incredible! ðŸš€",
                timestamp: "2023-05-15T10:30:00Z",
                echoes: 5,
                echoed: false
            },
            {
                id: 2,
                author: "0x9876...5432",
                content: "Web3 social media is the future. Love how creators get rewarded directly!",
                timestamp: "2023-05-15T09:15:00Z",
                echoes: 12,
                echoed: true
            }
        ];

        // DOM elements
        const loginButton = document.getElementById('loginButton');
        const walletInfo = document.getElementById('walletInfo');
        const walletAddress = document.getElementById('walletAddress');
        const walletBalance = document.getElementById('walletBalance');
        const postForm = document.getElementById('postForm');
        const postContent = document.getElementById('postContent');
        const submitPost = document.getElementById('submitPost');
        const feed = document.getElementById('feed');

        // Event listeners
        loginButton.addEventListener('click', handleLogin);
        submitPost.addEventListener('click', createPost);

        // Initialize the app
        renderFeed();

        // Handle login
        async function handleLogin() {
            // In a real implementation, this would integrate with Coinbase Wallet
            // For this MVP, we'll simulate a successful login
            currentUser = {
                address: "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6",
                balance: 100
            };
            
            // Update UI
            walletAddress.textContent = currentUser.address;
            walletBalance.textContent = currentUser.balance;
            walletInfo.style.display = 'block';
            postForm.style.display = 'block';
            loginButton.style.display = 'none';
            
            // Call backend to create/retrieve wallet
            try {
                const response = await fetch('http://localhost:3001/api/user/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userAddress: currentUser.address
                    })
                });
                
                const result = await response.json();
                console.log('Wallet setup result:', result);
            } catch (error) {
                console.error('Error setting up wallet:', error);
            }
        }

        // Create a new post
        function createPost() {
            const content = postContent.value.trim();
            if (!content) return;
            
            const newPost = {
                id: posts.length + 1,
                author: currentUser.address,
                content: content,
                timestamp: new Date().toISOString(),
                echoes: 0,
                echoed: false
            };
            
            posts.unshift(newPost);
            postContent.value = '';
            renderFeed();
        }

        // Echo a post
        async function echoPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post || post.echoed) return;
            
            // Update UI immediately
            post.echoed = true;
            post.echoes++;
            renderFeed();
            
            // In a real implementation, this would call the backend
            try {
                const response = await fetch(`http://localhost:3001/api/posts/${postId}/echo`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        echoer: currentUser.address
                    })
                });
                
                const result = await response.json();
                console.log('Echo result:', result);
                
                // Update balance if reward was given
                if (result.success && result.rewarded) {
                    currentUser.balance += 1; // Assuming 1 token reward
                    walletBalance.textContent = currentUser.balance;
                }
            } catch (error) {
                console.error('Error echoing post:', error);
                // Revert UI changes on error
                post.echoed = false;
                post.echoes--;
                renderFeed();
            }
        }

        // Render the feed
        function renderFeed() {
            feed.innerHTML = '<h2>Feed</h2>';
            
            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post';
                postElement.innerHTML = `
                    <div class="post-header">
                        <span class="post-author">${post.author}</span>
                        <span class="post-timestamp">${formatDate(post.timestamp)}</span>
                    </div>
                    <div class="post-content">
                        ${post.content}
                    </div>
                    <div class="post-actions">
                        <button class="echo-button ${post.echoed ? 'echoed' : ''}" onclick="echoPost(${post.id})">
                            ðŸ“¢ Echo${post.echoed ? 'ed' : ''} (${post.echoes})
                        </button>
                    </div>
                `;
                feed.appendChild(postElement);
            });
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString();
        }

        // Make echoPost available globally for onclick
        window.echoPost = echoPost;
    </script>
</body>
</html>